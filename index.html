<script>
document.addEventListener("DOMContentLoaded", () => {

const API_KEY = "CG-wsr54JajbpXGMajeRzYgZVQW";

const collections = {
  "BAYC": "bored-ape-yacht-club",
  "CryptoPunks": "cryptopunks",
  "Meebits": "meebits",
  "Moonbirds": "moonbirds",
  "Pudgy Penguins": "pudgy-penguins",
  "Good Vibes Club": "good-vibes-club"
};

const tbody = document.getElementById("table-body");
const status = document.getElementById("status");

status.textContent = "Starting fetch diagnosticsâ€¦";
tbody.innerHTML = "";

function row(msg) {
  const tr = document.createElement("tr");
  tr.innerHTML = <td colspan="4">${msg}</td>;
  tbody.appendChild(tr);
}

async function fetchNFT(name, slug) {
  row(â³ Fetching ${name}â€¦);

  try {
    const res = await fetch(
      https://api.coingecko.com/api/v3/nfts/${slug}?x_cg_demo_api_key=${API_KEY},
      { headers: { accept: "application/json" } }
    );

    row(ðŸ“¡ ${name} HTTP ${res.status});

    if (!res.ok) throw new Error(HTTP ${res.status});

    const d = await res.json();

    return {
      name,
      eth: d.floor_price?.native_currency ?? "â€”",
      usd: d.floor_price?.usd ? $${Math.round(d.floor_price.usd).toLocaleString()} : "â€”",
      change: d.floor_price_24h_percentage_change?.native_currency
    };

  } catch (e) {
    row(âŒ ${name} ERROR: ${e.message});
    return null;
  }
}

(async () => {
  const results = [];

  for (const [name, slug] of Object.entries(collections)) {
    const r = await fetchNFT(name, slug);
    if (r) results.push(r);
  }

  tbody.innerHTML = "";

  if (results.length === 0) {
    row("ðŸš¨ All requests failed or stalled.");
    status.textContent = "FAILED";
    return;
  }

  results.forEach(d => {
    const cls = d.change > 0 ? "positive" : d.change < 0 ? "negative" : "";
    const tr = document.createElement("tr");
    tr.innerHTML = 
      <td>${d.name}</td>
      <td>${d.eth}</td>
      <td>${d.usd}</td>
      <td class="${cls}">
        ${d.change != null ? d.change.toFixed(2) + "%" : "â€”"}
      </td>
    ;
    tbody.appendChild(tr);
  });

  status.textContent = "Completed at " + new Date().toLocaleTimeString();
})();
});
</script>
